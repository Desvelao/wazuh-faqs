<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/wazuh-faqs/styles.fdfdfe63115c5f1a6a77.css" data-identity="gatsby-global-css">.button{border:0;border-radius:3px;color:#fff;font-size:.8em;margin:0 5px;padding:10px;transition:all .2s ease-in-out}.button,.button:hover:enabled{background-color:var(--color-primary);cursor:pointer}.button:disabled{background-color:grey;cursor:default}.button-primary,.button-primary:hover:enabled{background-color:var(--color-primary);color:#fff}.button-primary:hover:enabled{cursor:pointer}.callout{-webkit-filter:var(--callout-filter);filter:var(--callout-filter);font-size:var(--callout-font-size);padding:var(--callout-padding)}.callout-info{background-color:var(--callout-info-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-info-border-color);color:var(--callout-info-color)}.callout-warning{background-color:var(--callout-warning-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-warning-border-color);color:var(--callout-warning-color)}.callout-danger{background-color:var(--callout-danger-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-danger-border-color);color:var(--callout-danger-color)}.card{border:1px solid var(--color-primary);border-radius:5px;padding:8px}.card:hover{box-shadow:0 0 2px var(--color-primary-shadow)}.card>.header{display:flex;justify-content:space-between}.card>.body{margin-top:4px}.card>.footer{align-items:center;display:flex;gap:.5rem;justify-content:space-between;margin-top:.5rem}.card>.body>.description{color:var(--color-subdued);font-size:.9em}.tooltip-wrapper{display:inline-block;position:relative}.tooltip-tip{background:var(--tooltip-background-color);border-radius:4px;color:var(--tooltip-text-color);font-family:sans-serif;font-size:14px;left:50%;line-height:1;padding:6px;position:absolute;-webkit-transform:translateX(-50%);transform:translateX(-50%);white-space:nowrap;z-index:100}.tooltip-tip:before{border:solid transparent;border-width:var(--tooltip-arrow-size);content:" ";height:0;left:50%;margin-left:calc(var(--tooltip-arrow-size)*-1);pointer-events:none;position:absolute;width:0}.tooltip-tip.top{top:calc(var(--tooltip-margin)*-1)}.tooltip-tip.top:before{border-top-color:var(--tooltip-background-color);top:100%}.tooltip-tip.right{left:calc(100% + var(--tooltip-margin))}.tooltip-tip.right,.tooltip-tip.right:before{top:50%;-webkit-transform:translateX(0) translateY(-50%);transform:translateX(0) translateY(-50%)}.tooltip-tip.right:before{border-right-color:var(--tooltip-background-color);left:calc(var(--tooltip-arrow-size)*-1)}.tooltip-tip.bottom{bottom:calc(var(--tooltip-margin)*-1)}.tooltip-tip.bottom:before{border-bottom-color:var(--tooltip-background-color);bottom:100%}.tooltip-tip.left{right:calc(100% + var(--tooltip-margin))}.tooltip-tip.left,.tooltip-tip.left:before{left:auto;top:50%;-webkit-transform:translateX(0) translateY(-50%);transform:translateX(0) translateY(-50%)}.tooltip-tip.left:before{border-left-color:var(--tooltip-background-color);right:calc(var(--tooltip-arrow-size)*-2)}.spacer-s{height:var(--spacer-s)}.spacer-m{height:var(--spacer-m)}.spacer-l{height:var(--spacer-l)}.input{padding:4px}.input[type=file]{display:none}:root{--color-primary:#2274a5;--color-primary-contrast:#fff;--color-primary-shadow:#131b23;--color-secondary:#e7dfc6;--color-secondary-contrast:#2274a5;--color-success:#ff0;--color-warning:#ff0;--color-error:#ff0;--color-link:green;--color-subdued:gray;--color-contrast:#131b23;--color-markdown-code:#d3d3d3;--color-faq-code:#dcdcdc;--spacer-s:5px;--spacer-m:12px;--spacer-l:18px;--tooltip-text-color:#fff;--tooltip-background-color:#000;--tooltip-margin:30px;--tooltip-arrow-size:6px;--callout-info-backgorund-color:#2274a5;--callout-info-border-color:blue;--callout-info-color:#fff;--callout-warning-backgorund-color:#ff0;--callout-warning-border-color:blue;--callout-warning-color:#fff;--callout-danger-backgorund-color:red;--callout-danger-border-color:blue;--callout-danger-color:#fff;--callout-border-size:0.2em;--callout-border-type:solid;--callout-padding:0.5em;--callout-font-size:0.8rem;--callout-filter:brightness(0.9);--card-test-ui-background-color:var(--color-primary);--card-test-ui-color:var(--color-primary-contrast);--card-test-backend-background-color:var(--color-secondary);--card-test-backend-color:var(--color-secondary-contrast)}body{color:#232129;font-family:Roboto,-apple-system,sans-serif,serif;margin:0}.layout_menu{background-color:var(--color-primary);height:3rem;margin-bottom:3rem;position:fixed;top:0;width:100%}.layout_menu>.layout_menu_links{align-items:center;display:flex;height:100%}.layout_menu_links a{color:var(--color-primary-contrast);margin:0 5px}.layout_main{margin-top:3rem;padding:16px}.layout_buttons{align-items:center;display:flex;justify-content:flex-end}.markdown code{background-color:var(--color-markdown-code);padding:2px}.faq{max-width:100%;padding:0 15%}.faq code{background-color:var(--color-faq-code);line-height:2em;white-space:break-spaces}.faq code,.tag{border-radius:3px}.tag{align-items:center;color:var(--color-primary);display:flex;font-size:.8em;justify-content:center;padding:4px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.color-primary-all{background-color:var(--color-primary);color:var(--color-primary-contrast)}.input{font-size:16px;padding:10px}.text-subdued{color:var(--color-subdued)}.table{border-collapse:collapse;font-family:arial,sans-serif;width:100%}.table td,.table th{border:1px solid var(--color-primary);padding:8px;text-align:left}.table thead,.table tr:nth-child(2n){background-color:var(--color-primary);color:var(--color-primary-contrast)}.table thead td{padding:12px 8px}.tabs:after{border-bottom:1px solid var(--color-primary);content:"";display:"block"!important;height:2px}.tabs ul{padding:0}.tabs li{color:var(--color-primary);display:inline;list-style:none;padding:5px 5px 2px}.tabs li.tab-selected{background-color:var(--color-primary);border-radius:3px;color:var(--color-primary-contrast)}.search-bar{align-items:center;display:flex;gap:.5rem}.search-bar .input{border:1px solid var(--color-primary);border-radius:.25rem;font-size:.9rem;padding:.5rem;width:100%}.apps-search-bar{align-items:center;display:flex;justify-content:center}.apps-layout{display:grid;gap:1.25rem;grid-auto-rows:auto;grid-template-columns:repeat(3,1fr);>.card{margin-bottom:0!important}}.card-test-ui{background-color:var(--card-test-ui-background-color);color:var(--card-test-ui-color)}.card-test-backend{background-color:var(--card-test-backend-background-color);color:var(--card-test-backend-color)}.cards{display:grid;gap:1.25rem;grid-auto-rows:auto;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));width:100%;>.card{margin-bottom:0!important}}.checkboxes{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fill,minmax(160px,auto))}.container{display:flex;flex-direction:column;gap:.5rem}.m-xs{margin:4px}.m-s{margin:8px}.m-m{margin:4px}.m-l{margin:8px}.mt-xs,.my-xs{margin-top:4px}.mb-xs,.my-xs{margin-bottom:4px}.ml-xs,.mx-xs{margin-left:4px}.mr-xs,.mx-xs{margin-right:4px}.mt-s,.my-s{margin-top:8px}.mb-s,.my-s{margin-bottom:8px}.ml-s,.mx-s{margin-left:8px}.mr-s,.mx-s{margin-right:8px}.mt-m,.my-m{margin-top:12px}.mb-m,.my-m{margin-bottom:12px}.ml-m,.mx-m{margin-left:12px}.mr-m,.mx-m{margin-right:12px}.mt-l,.my-l{margin-top:16px}.mb-l,.my-l{margin-bottom:16px}.ml-l,.mx-l{margin-left:16px}.mr-l,.mx-l{margin-right:16px}.d-block{display:block}.d-flex{display:flex}.d-inline{display:inline}.d-inline-block{display:inline-block}.background-color-disabled{background-color:#dcdcdc}.cursor-pointer{cursor:pointer}.t-center{text-align:center}.color-subdued{color:var(--color-subdued)}input,textarea{padding:10px}.tags{display:flex;flex-wrap:wrap;gap:.25rem}</style><meta name="generator" content="Gatsby 3.8.1"/><link as="script" rel="preload" href="/wazuh-faqs/webpack-runtime-a8dc8a6130a16e818571.js"/><link as="script" rel="preload" href="/wazuh-faqs/framework-1f0ab9948a93cedbe3b5.js"/><link as="script" rel="preload" href="/wazuh-faqs/app-a7f2409eada534089f52.js"/><link as="script" rel="preload" href="/wazuh-faqs/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/faqs/redefine-timestamp-field/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/sq/d/1340339594.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout_menu"><div class="layout_menu_links"><div style="display:flex;justify-content:space-between;align-items:center;width:100%"><div><a href="/wazuh-faqs/">Home</a><a href="/wazuh-faqs/apps">Apps</a><a style="color:black" href="/wazuh-faqs/faqs">FAQs</a><a href="/wazuh-faqs/dev-utils">Development utils</a></div></div></div></div><div class="layout_main"><div class="markdown faq"><h1 style="display:inline">Redefine the timestamp field using another field at ingestion time</h1><div class="mb-s" style="position:fixed;bottom:10px;right:10px"><div><button class="button ">Copy remediation (in Markdown)</button></div></div><div class="tags"><span class="tag cursor-pointer background-color-disabled">elasticsearch</span><span class="tag cursor-pointer background-color-disabled">timestamp</span><span class="tag cursor-pointer background-color-disabled">wazuh-indexer</span><div class="spacer-m"></div></div><div class="faq-content"><h3>Issue</h3>
<p>Set the <code>timestamp</code> field using another extracted field.</p>
<h3>Remediation</h3>
<h2>Alerts: Future events</h2>
<p>If the event is related to <code>alerts</code> or <code>archives</code> datasets, modify the ingest pipeline processors. See <a href='/faqs/filebeat-modify-ingest-pipeline'>modify ingest pipeline</a>.</p>
<p>For example, for setting the <code>timestamp</code> field using the <code>data.aws.eventTime</code> field, add the following ingest pipeline proccessor to the pipeline:</p>
<pre><code class="language-json">{
  "date": {
    "if": "ctx.data != null &#x26;&#x26; ctx.data.aws != null &#x26;&#x26; ctx.data.aws.eventTime != null",
    "field": "data.aws.eventTime",
    "target_field": "timestamp",
    "formats": ["ISO8601"],
    "ignore_failure": true
  }
},
</code></pre>
<blockquote>
<p>Notes:
Ensure defining this processor before the processor that defines the <code>@timestamp</code> field using the <code>timestamp</code> field <a href="https://github.com/wazuh/wazuh/blob/v4.12.0/extensions/filebeat/7.x/wazuh-module/alerts/ingest/pipeline.json#L103-L111">https://github.com/wazuh/wazuh/blob/v4.12.0/extensions/filebeat/7.x/wazuh-module/alerts/ingest/pipeline.json#L103-L111</a> to the <code>timestamp</code> and <code>@timestamp</code> fields has the same value.</p>
<p>The <code>formats</code> property defines the expected format of the <code>field</code> property to convert to date, so ensure the value of the <code>field</code> property has a matching format with the <code>formats</code> property, else this could give error.</p>
<p>The <code>ignore_failure</code> property sets as <code>true</code> will ignore any failure that will not cause the document can be dropped and not indexed into Wazuh indexer.</p>
</blockquote>
<h2>Existant documents</h2>
<p>Use the Wazuh indexer API to update the <code>timestamp</code> field to a value from the field reference through the <code>POST &#x3C;index_or_index_pattern>/_update_by_query</code></p>
<p>Take special attention to the expected format of date stored in the <code>timestamp</code> field ensuring the update of the <code>timestamp</code> field keeps the similar format.</p>
<p>Assuming this has the following format: <code>"yyyy-MM-dd'T'HH:mm:ss.SSSZ"</code>, you could update the <code>timestamp</code> fields with:</p>
<pre><code>POST &#x3C;index_or_index_pattern>/_update_by_query
{
  "script": {
    "source": """if (ctx._source.data != null &#x26;&#x26; ctx._source.data.aws != null &#x26;&#x26; ctx._source.data.aws.eventTime != null) {
        // Get the eventTime string from the keyword field.
        String eventTime = ctx._source.data.aws.eventTime;
        // Parse the eventTime string into a ZonedDateTime.
        ZonedDateTime zdt = ZonedDateTime.parse(eventTime);
        // Convert the ZonedDateTime to a java.util.Date.
        Date date = Date.from(zdt.toInstant());
        // Create a formatter with the desired pattern.
        def sdf = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ");
        // Set the formatter timezone to UTC to ensure "+0000" is appended.
        sdf.setTimeZone(java.util.TimeZone.getTimeZone("UTC"));
        // Format the date and update the timestamp field.
        ctx._source.timestamp = sdf.format(date);
      }""",
    "lang": "painless"
  },
  "query": {
    "script": {
      "script": {
        "source": "if (doc['data.aws.eventTime'].size() == 0 || doc['timestamp'].size() == 0) { return false; } return true;",
        "lang": "painless"
      }
    }
  }
}
</code></pre>
<p>If you want to compare visually the values fo <code>timestamp</code> and <code>data.aws.eventTime</code> values:</p>
<pre><code>GET wazuh-alerts-*/_search
{
  "size": 10000,
  "_source": ["timestamp", "data.aws.eventTime"],
  "query": {
    "exists": {
      "field": "data.aws.eventTime"
    }
  }
}
</code></pre>
<p>replace the placeholders:</p>
<ul>
<li><code>&#x3C;index_or_index_pattern></code>: index or index pattern to apply the documents update</li>
</ul>
<blockquote>
<p>This query returns the first 10000 documents where the <code>data.aws.eventTime</code> field exist and returns the <code>timestamp</code> and <code>data.aws.eventTime</code> fields for the <code>wazuh-alerts-*</code> index pattern. If you know some indices where the <code>timestamp</code> and <code>data.aws.eventTime</code> fields does not match, consider to check these indices using the request commented above.</p>
</blockquote></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/faqs/redefine-timestamp-field/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c36a95dc72563b2c65a2.js"],"app":["/app-a7f2409eada534089f52.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0c1ec93cb0824e8452b4.js"],"component---src-pages-apps-apps-json-slug-js":["/component---src-pages-apps-apps-json-slug-js-f08bacb352f5a8260b11.js"],"component---src-pages-apps-index-js":["/component---src-pages-apps-index-js-f348848906d774c0ee98.js"],"component---src-pages-daily-time-js":["/component---src-pages-daily-time-js-51dcd51b2fbac28c56c3.js"],"component---src-pages-dev-utils-index-js":["/component---src-pages-dev-utils-index-js-7b147f930ba2ff712a03.js"],"component---src-pages-dev-utils-tests-report-template-js":["/component---src-pages-dev-utils-tests-report-template-js-94078d507a88506a42c2.js"],"component---src-pages-faqs-index-js":["/component---src-pages-faqs-index-js-da8e57b3b3be28838849.js"],"component---src-pages-faqs-markdown-remark-frontmatter-slug-js":["/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-352e21489361c9ee74b3.js"]};/*]]>*/</script><script src="/wazuh-faqs/polyfill-c36a95dc72563b2c65a2.js" nomodule=""></script><script src="/wazuh-faqs/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js" async=""></script><script src="/wazuh-faqs/app-a7f2409eada534089f52.js" async=""></script><script src="/wazuh-faqs/framework-1f0ab9948a93cedbe3b5.js" async=""></script><script src="/wazuh-faqs/webpack-runtime-a8dc8a6130a16e818571.js" async=""></script></body></html>