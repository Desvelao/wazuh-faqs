<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/wazuh-faqs/styles.fdfdfe63115c5f1a6a77.css" data-identity="gatsby-global-css">.button{border:0;border-radius:3px;color:#fff;font-size:.8em;margin:0 5px;padding:10px;transition:all .2s ease-in-out}.button,.button:hover:enabled{background-color:var(--color-primary);cursor:pointer}.button:disabled{background-color:grey;cursor:default}.button-primary,.button-primary:hover:enabled{background-color:var(--color-primary);color:#fff}.button-primary:hover:enabled{cursor:pointer}.callout{-webkit-filter:var(--callout-filter);filter:var(--callout-filter);font-size:var(--callout-font-size);padding:var(--callout-padding)}.callout-info{background-color:var(--callout-info-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-info-border-color);color:var(--callout-info-color)}.callout-warning{background-color:var(--callout-warning-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-warning-border-color);color:var(--callout-warning-color)}.callout-danger{background-color:var(--callout-danger-backgorund-color);border-left:var(--callout-border-size) var(--callout-border-type) var(--callout-danger-border-color);color:var(--callout-danger-color)}.card{border:1px solid var(--color-primary);border-radius:5px;padding:8px}.card:hover{box-shadow:0 0 2px var(--color-primary-shadow)}.card>.header{display:flex;justify-content:space-between}.card>.body{margin-top:4px}.card>.footer{align-items:center;display:flex;gap:.5rem;justify-content:space-between;margin-top:.5rem}.card>.body>.description{color:var(--color-subdued);font-size:.9em}.tooltip-wrapper{display:inline-block;position:relative}.tooltip-tip{background:var(--tooltip-background-color);border-radius:4px;color:var(--tooltip-text-color);font-family:sans-serif;font-size:14px;left:50%;line-height:1;padding:6px;position:absolute;-webkit-transform:translateX(-50%);transform:translateX(-50%);white-space:nowrap;z-index:100}.tooltip-tip:before{border:solid transparent;border-width:var(--tooltip-arrow-size);content:" ";height:0;left:50%;margin-left:calc(var(--tooltip-arrow-size)*-1);pointer-events:none;position:absolute;width:0}.tooltip-tip.top{top:calc(var(--tooltip-margin)*-1)}.tooltip-tip.top:before{border-top-color:var(--tooltip-background-color);top:100%}.tooltip-tip.right{left:calc(100% + var(--tooltip-margin))}.tooltip-tip.right,.tooltip-tip.right:before{top:50%;-webkit-transform:translateX(0) translateY(-50%);transform:translateX(0) translateY(-50%)}.tooltip-tip.right:before{border-right-color:var(--tooltip-background-color);left:calc(var(--tooltip-arrow-size)*-1)}.tooltip-tip.bottom{bottom:calc(var(--tooltip-margin)*-1)}.tooltip-tip.bottom:before{border-bottom-color:var(--tooltip-background-color);bottom:100%}.tooltip-tip.left{right:calc(100% + var(--tooltip-margin))}.tooltip-tip.left,.tooltip-tip.left:before{left:auto;top:50%;-webkit-transform:translateX(0) translateY(-50%);transform:translateX(0) translateY(-50%)}.tooltip-tip.left:before{border-left-color:var(--tooltip-background-color);right:calc(var(--tooltip-arrow-size)*-2)}.spacer-s{height:var(--spacer-s)}.spacer-m{height:var(--spacer-m)}.spacer-l{height:var(--spacer-l)}.input{padding:4px}.input[type=file]{display:none}:root{--color-primary:#2274a5;--color-primary-contrast:#fff;--color-primary-shadow:#131b23;--color-secondary:#e7dfc6;--color-secondary-contrast:#2274a5;--color-success:#ff0;--color-warning:#ff0;--color-error:#ff0;--color-link:green;--color-subdued:gray;--color-contrast:#131b23;--color-markdown-code:#d3d3d3;--color-faq-code:#dcdcdc;--spacer-s:5px;--spacer-m:12px;--spacer-l:18px;--tooltip-text-color:#fff;--tooltip-background-color:#000;--tooltip-margin:30px;--tooltip-arrow-size:6px;--callout-info-backgorund-color:#2274a5;--callout-info-border-color:blue;--callout-info-color:#fff;--callout-warning-backgorund-color:#ff0;--callout-warning-border-color:blue;--callout-warning-color:#fff;--callout-danger-backgorund-color:red;--callout-danger-border-color:blue;--callout-danger-color:#fff;--callout-border-size:0.2em;--callout-border-type:solid;--callout-padding:0.5em;--callout-font-size:0.8rem;--callout-filter:brightness(0.9);--card-test-ui-background-color:var(--color-primary);--card-test-ui-color:var(--color-primary-contrast);--card-test-backend-background-color:var(--color-secondary);--card-test-backend-color:var(--color-secondary-contrast)}body{color:#232129;font-family:Roboto,-apple-system,sans-serif,serif;margin:0}.layout_menu{background-color:var(--color-primary);height:3rem;margin-bottom:3rem;position:fixed;top:0;width:100%}.layout_menu>.layout_menu_links{align-items:center;display:flex;height:100%}.layout_menu_links a{color:var(--color-primary-contrast);margin:0 5px}.layout_main{margin-top:3rem;padding:16px}.layout_buttons{align-items:center;display:flex;justify-content:flex-end}.markdown code{background-color:var(--color-markdown-code);padding:2px}.faq{max-width:100%;padding:0 15%}.faq code{background-color:var(--color-faq-code);line-height:2em;white-space:break-spaces}.faq code,.tag{border-radius:3px}.tag{align-items:center;color:var(--color-primary);display:flex;font-size:.8em;justify-content:center;padding:4px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content}.color-primary-all{background-color:var(--color-primary);color:var(--color-primary-contrast)}.input{font-size:16px;padding:10px}.text-subdued{color:var(--color-subdued)}.table{border-collapse:collapse;font-family:arial,sans-serif;width:100%}.table td,.table th{border:1px solid var(--color-primary);padding:8px;text-align:left}.table thead,.table tr:nth-child(2n){background-color:var(--color-primary);color:var(--color-primary-contrast)}.table thead td{padding:12px 8px}.tabs:after{border-bottom:1px solid var(--color-primary);content:"";display:"block"!important;height:2px}.tabs ul{padding:0}.tabs li{color:var(--color-primary);display:inline;list-style:none;padding:5px 5px 2px}.tabs li.tab-selected{background-color:var(--color-primary);border-radius:3px;color:var(--color-primary-contrast)}.search-bar{align-items:center;display:flex;gap:.5rem}.search-bar .input{border:1px solid var(--color-primary);border-radius:.25rem;font-size:.9rem;padding:.5rem;width:100%}.apps-search-bar{align-items:center;display:flex;justify-content:center}.apps-layout{display:grid;gap:1.25rem;grid-auto-rows:auto;grid-template-columns:repeat(3,1fr);>.card{margin-bottom:0!important}}.card-test-ui{background-color:var(--card-test-ui-background-color);color:var(--card-test-ui-color)}.card-test-backend{background-color:var(--card-test-backend-background-color);color:var(--card-test-backend-color)}.cards{display:grid;gap:1.25rem;grid-auto-rows:auto;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));width:100%;>.card{margin-bottom:0!important}}.checkboxes{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fill,minmax(160px,auto))}.container{display:flex;flex-direction:column;gap:.5rem}.m-xs{margin:4px}.m-s{margin:8px}.m-m{margin:4px}.m-l{margin:8px}.mt-xs,.my-xs{margin-top:4px}.mb-xs,.my-xs{margin-bottom:4px}.ml-xs,.mx-xs{margin-left:4px}.mr-xs,.mx-xs{margin-right:4px}.mt-s,.my-s{margin-top:8px}.mb-s,.my-s{margin-bottom:8px}.ml-s,.mx-s{margin-left:8px}.mr-s,.mx-s{margin-right:8px}.mt-m,.my-m{margin-top:12px}.mb-m,.my-m{margin-bottom:12px}.ml-m,.mx-m{margin-left:12px}.mr-m,.mx-m{margin-right:12px}.mt-l,.my-l{margin-top:16px}.mb-l,.my-l{margin-bottom:16px}.ml-l,.mx-l{margin-left:16px}.mr-l,.mx-l{margin-right:16px}.d-block{display:block}.d-flex{display:flex}.d-inline{display:inline}.d-inline-block{display:inline-block}.background-color-disabled{background-color:#dcdcdc}.cursor-pointer{cursor:pointer}.t-center{text-align:center}.color-subdued{color:var(--color-subdued)}input,textarea{padding:10px}.tags{display:flex;flex-wrap:wrap;gap:.25rem}</style><meta name="generator" content="Gatsby 3.8.1"/><link as="script" rel="preload" href="/wazuh-faqs/webpack-runtime-a8dc8a6130a16e818571.js"/><link as="script" rel="preload" href="/wazuh-faqs/framework-1f0ab9948a93cedbe3b5.js"/><link as="script" rel="preload" href="/wazuh-faqs/app-a7f2409eada534089f52.js"/><link as="script" rel="preload" href="/wazuh-faqs/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/faqs/elasticsearch-reached-shards-limit-by-node/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/sq/d/1340339594.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/wazuh-faqs/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout_menu"><div class="layout_menu_links"><div style="display:flex;justify-content:space-between;align-items:center;width:100%"><div><a href="/wazuh-faqs/">Home</a><a href="/wazuh-faqs/apps">Apps</a><a style="color:black" href="/wazuh-faqs/faqs">FAQs</a><a href="/wazuh-faqs/dev-utils">Development utils</a></div></div></div></div><div class="layout_main"><div class="markdown faq"><h1 style="display:inline">Reached the shards limit by node</h1><div class="mb-s" style="position:fixed;bottom:10px;right:10px"><div><button class="button ">Copy remediation (in Markdown)</button></div></div><div class="tags"><span class="tag cursor-pointer background-color-disabled">elasticsearch</span><span class="tag cursor-pointer background-color-disabled">shards</span><span class="tag cursor-pointer background-color-disabled">wazuh-indexer</span><div class="spacer-m"></div></div><div class="color-subdued">shards limits</div><div class="spacer-m"></div><div class="faq-content"><h3>Issue</h3>
<p>Error in Elasticsearch/Wazuh indexer:</p>
<pre><code>"Validation Failed: 1: this action would add [2] total shards, but this cluster currently has [999]/[1000] maximum shards open;"
</code></pre>
<h3>Remediation</h3>
<p>This means the shards limit count was reached (<code>1000</code> by default in the node). To fix this issue, there are multiple options:</p>
<ul>
<li><strong>Delete indices</strong>. This frees shards. You could do it with old indices you don't want/need. Or even, you could automate it with ILM/ISM policies to delete old indices after a period of time as explained in this post: <a href="https://wazuh.com/blog/wazuh-index-management">https://wazuh.com/blog/wazuh-index-management</a>.</li>
</ul>
<p>Note:</p>
<ul>
<li>ILM: Index Lifecycle Management (used by X-Pack)</li>
<li>ISM: Index State Management (used by Open Distro for Elasticsearch and OpenSearch)</li>
</ul>
<p>The automation of the indices deletion through ILM/ISM policies is recommended because reduces manual maintenance.</p>
<ul>
<li>
<p><strong>Add more nodes</strong> to your Elasticserach/Wazuh indexer cluster.</p>
</li>
<li>
<p><strong>Increment the max shards per node</strong> (not recommended). But if you do this option, make sure you do not increase it too much, as it could cause inoperability and performance issues in your Elasticsearch/Wazuh indexer cluster. To do this:</p>
<pre><code class="language-sh">curl -k -u USERNAME:PASSWORD -XPUT ELASTICSEARCH_HOST_ADDRESS/_cluster/settings -H "Content-Type: application/json" \
-d '{ "persistent": { "cluster.max_shards_per_node": "MAX_SHARDS_PER_NODE" } }'
</code></pre>
<p>replace the placeholders, where:</p>
<ul>
<li><code>USERNAME</code> : username to do the request</li>
<li><code>PASSWORD</code> : password for the user</li>
<li><code>ELASTICSEARCH_HOST_ADDRESS</code>: Elasticsearch/Wazuh indexer host address. Include the protocol https if needed.</li>
<li><code>MAX_SHARDS_PER_NODE</code>: Maximum shards by node. Maybe you could try with 1200 o something like that, depending of your case.</li>
</ul>
</li>
<li>
<p><strong>Reduce the shards consumed by the indices</strong>: reduce the shards of existent indices and configure if possible for the new ones.</p>
<ul>
<li><code>wazuh-alerts-4.x-*</code> indices: <a href="https://documentation.wazuh.com/current/user-manual/elasticsearch/elastic-tuning.html#shards-and-replicas">https://documentation.wazuh.com/current/user-manual/elasticsearch/elastic-tuning.html#shards-and-replicas</a>.</li>
<li><code>wazuh-monitoring-*</code> and <code>wazuh-statistics-*</code> indices: they can be configured in the Wazuh plugin settings from the UI <code>Settings/Configuration</code> or through the configuration file <code>wazuh.yml</code>.</li>
<li>General application <a href="https://opster.com/guides/elasticsearch/capacity-planning/elasticsearch-reduce-shards/">https://opster.com/guides/elasticsearch/capacity-planning/elasticsearch-reduce-shards/</a>.</li>
</ul>
</li>
</ul>
<p>More info: <a href="https://www.elastic.co/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster">https://www.elastic.co/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster</a>.</p></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/faqs/elasticsearch-reached-shards-limit-by-node/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c36a95dc72563b2c65a2.js"],"app":["/app-a7f2409eada534089f52.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0c1ec93cb0824e8452b4.js"],"component---src-pages-apps-apps-json-slug-js":["/component---src-pages-apps-apps-json-slug-js-f08bacb352f5a8260b11.js"],"component---src-pages-apps-index-js":["/component---src-pages-apps-index-js-f348848906d774c0ee98.js"],"component---src-pages-daily-time-js":["/component---src-pages-daily-time-js-51dcd51b2fbac28c56c3.js"],"component---src-pages-dev-utils-index-js":["/component---src-pages-dev-utils-index-js-7b147f930ba2ff712a03.js"],"component---src-pages-dev-utils-tests-report-template-js":["/component---src-pages-dev-utils-tests-report-template-js-94078d507a88506a42c2.js"],"component---src-pages-faqs-index-js":["/component---src-pages-faqs-index-js-da8e57b3b3be28838849.js"],"component---src-pages-faqs-markdown-remark-frontmatter-slug-js":["/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js"],"component---src-pages-index-js":["/component---src-pages-index-js-352e21489361c9ee74b3.js"]};/*]]>*/</script><script src="/wazuh-faqs/polyfill-c36a95dc72563b2c65a2.js" nomodule=""></script><script src="/wazuh-faqs/component---src-pages-faqs-markdown-remark-frontmatter-slug-js-68747487d3076368c92b.js" async=""></script><script src="/wazuh-faqs/app-a7f2409eada534089f52.js" async=""></script><script src="/wazuh-faqs/framework-1f0ab9948a93cedbe3b5.js" async=""></script><script src="/wazuh-faqs/webpack-runtime-a8dc8a6130a16e818571.js" async=""></script></body></html>