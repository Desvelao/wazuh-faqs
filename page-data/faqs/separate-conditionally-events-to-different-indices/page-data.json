{"componentChunkName":"component---src-pages-faqs-markdown-remark-frontmatter-slug-js","path":"/faqs/separate-conditionally-events-to-different-indices/","result":{"data":{"markdownRemark":{"html":"<h3>Issue</h3>\n<p>Separate conditionally alerts or archives to different indices</p>\n<h3>Remediation</h3>\n<p>The Wazuh alerts or archives are indexed through an ingest pipeline. Theses pipelines have a processor that sets the index name using the <code>date_index_name</code> processor with the following schema:</p>\n<ul>\n<li>a prefix: <code>wazuh-alerts-4.x-</code> for alerts or <code>wazuh-archives-4.x-*</code> for archives</li>\n<li>a suffix: date in the format <code>YYYY.MM.DD</code></li>\n</ul>\n<p>generating a index name as <code>wazuh-alerts-4.x-2023-10-20</code> or <code>wazuh-archives-4.x-2023-10-20</code>.</p>\n<p>Note that <code>alerts</code> and <code>archives</code> dataset have different ingest pipelines</p>\n<p>Reference of usage <code>date_index_name</code> processor in the alerts ingets pipeline of <code>wazuh</code> module for Filebeat: <a href=\"https://github.com/wazuh/wazuh/blob/v4.5.3/extensions/filebeat/7.x/wazuh-module/alerts/ingest/pipeline.json#L83-L91\">https://github.com/wazuh/wazuh/blob/v4.5.3/extensions/filebeat/7.x/wazuh-module/alerts/ingest/pipeline.json#L83-L91</a>.</p>\n<p>To separate some events to another index, adds after the default <code>date_index_name</code> processor, another processor that sets conditionally the index name for a subset of events. Add the condition to apply these processor using the <code>if</code> property. Documentation: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html#conditionally-run-processor\">https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html#conditionally-run-processor</a>.</p>\n<p>Depending on the format of the index name:</p>\n<ul>\n<li>contains the date: use the <code>date_index_name</code> processor <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/date-index-name-processor.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/date-index-name-processor.html</a>\n<pre><code>{\n    \"date_index_name\" : {\n        \"field\" : \"timestamp\",\n        \"date_rounding\" : \"d\"\n        \"index_name_prefix\" : \"my-index-name-\",\n        \"index_name_format\": \"yyyy.MM.dd\",\n        \"ignore_failure\": false,\n        \"if\": \"CONDITION\"\n    }\n}\n</code></pre>\n</li>\n<li>fixed: use the <code>set</code> processor to set the <code>_index</code> name <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/set-processor.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/set-processor.html</a>\n<pre><code>{\n    \"set\": {\n        \"field\" : \"_index\",\n        \"value\" : \"my-index-name\",\n        \"ignore_failure\" : true\n        \"if\": \"CONDITION\"\n    }\n}\n</code></pre>\n</li>\n</ul>\n<p>Replace the <code>CONDITION</code> placeholder by the condition to separate the event to another index. See the how to run contionally the processor <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/ingest-conditionals.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/ingest-conditionals.html</a>.</p>\n<p>The ingest pipeline can be modified through:</p>\n<ul>\n<li>editing the ingest pipeline file of <code>wazuh</code> module used by Filebeat.\n<ol>\n<li>Edit the ingest pipeline.json file adding the processor</li>\n<li>Update the pipeline</li>\n</ol>\n<pre><code>filebeat setup --pipelines\n</code></pre>\n</li>\n<li>using the Wazuh indexer/Elasticsearch API\n<ul>\n<li>udpate pipeline: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/put-pipeline-api.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/put-pipeline-api.html</a></li>\n<li>get pipeline: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/get-pipeline-api.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/get-pipeline-api.html</a></li>\n</ul>\n</li>\n</ul>\n<p>Ensure the ingest pipeline was modified correctly. The new events should be separated in different indices according to the ingest pipeline.</p>\n<p>References:</p>\n<ul>\n<li>Ingest pipeline processors: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/7.10/ingest-processors.html\">https://www.elastic.co/guide/en/elasticsearch/reference/7.10/ingest-processors.html</a></li>\n</ul>","frontmatter":{"date":"October 20, 2023","slug":"separate-conditionally-events-to-different-indices","title":"Separate conditionally events to different indices","tags":["elasticsearch","events","index","wazuh-indexer"],"version":"","description":"Separate conditionally events to different indices","author":"Desvelao"}}},"pageContext":{"id":"bdbc15c6-8444-582d-9c69-272759967174","frontmatter__slug":"separate-conditionally-events-to-different-indices","__params":{"frontmatter__slug":"separate-conditionally-events-to-different-indices"}}},"staticQueryHashes":["1340339594"]}